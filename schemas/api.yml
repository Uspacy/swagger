openapi: '3.0.n'
info:
  title: Uspacy api
  version: 1.0.0
servers:
  - url: http://127.0.0.1:8000
tags:
  - name: usersService
  - name: authService
  - name: departmentsService
  - name: newsFeedService
  - name: tasksService

paths:
  # users begin
  /company/v1/users/:
    get:
      description: Get users list. Available only for authorized users.
      tags:
        - usersService
      parameters:
        - $ref: '#/components/parameters/page'
        - $ref: '#/components/parameters/list'
        # - $ref: '#/components/parameters/queryUsers'
        - $ref: '#/components/parameters/filterUsers'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  meta:
                    type: object
                    $ref: '#/components/schemas/Meta'
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/User'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
      security:
        - bearerAuth: []
    post:
      description: Sign up user by firstName, lastName, email, password. Available only for users with admin permissions. Returns created user
      tags:
        - usersService
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              $ref: '#/components/schemas/SignUpDto'
      responses:
        '201':
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    allOf:
                      - $ref: '#/components/schemas/User'
                      - type: object
                        properties:
                          position:
                            example: ''
                          phone:
                            example: ''
                          birthday:
                            example: 0
                          roles:
                            example: '["USER"]'
                          departmentsIds:
                            example: "[]"
                          socialMedia:
                            example: "[]"

          description: Created
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/Forbidden'
      security:
        - bearerAuth: []
  /company/v1/users/{userId}/:
    parameters:
      - $ref: '#/components/parameters/userId'
    get:
      tags:
        - usersService
      description: Get user by id. Available only for authorized users
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    $ref: '#/components/schemas/User'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
      security:
        - bearerAuth: []
    patch:
      description: Update user data by id. Available only for authorized users
      tags:
        - usersService
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              $ref: '#/components/schemas/UpdateUserDto'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/User'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
      security:
        - bearerAuth: []
  /company/v1/users/{userId}/deactivate/:
    post:
      description: "Deactivate user by id. Available only for users with admin permissions. Returns user data with active: false"
      tags:
        - usersService
      parameters:
        - $ref: '#/components/parameters/userId'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    allOf:
                      - $ref: '#/components/schemas/User'
                      - type: object
                        properties:
                          active:
                            example: false
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/Forbidden'
      security:
        - bearerAuth: []
  /company/v1/users/{userId}/activate/:
    post:
      description: "Activate user by id. Available only for users with admin permissions. Returns user data with active: true"
      tags:
        - usersService
      parameters:
        - $ref: '#/components/parameters/userId'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    $ref: '#/components/schemas/User'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/Forbidden'
      security:
        - bearerAuth: []
  /company/v1/users/{userId}/updateRoles/:
    patch:
      description: Update user roles by id. Available only for users with admin permissions. Returns user data with new roles
      tags:
        - usersService
      parameters:
        - $ref: '#/components/parameters/userId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              $ref: '#/components/schemas/UpdateRolesDto'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    allOf:
                      - $ref: '#/components/schemas/User'
                      - type: object
                        properties:
                          roles:
                            allOf:
                              - type: string
                                example:
                                  - ADMIN
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/Forbidden'
      security:
        - bearerAuth: []
  /company/v1/users/{userId}/updatePosition/:
    patch:
      description: Update user position by id. Available only for users with admin permissions. Returns user data with new position
      tags:
        - usersService
      parameters:
        - $ref: '#/components/parameters/userId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              $ref: '#/components/schemas/UpdateUserPosition'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    allOf:
                      - $ref: '#/components/schemas/User'
                      - type: object
                        properties:
                          position:
                            example: new position

        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/Forbidden'
      security:
        - bearerAuth: []
  /company/v1/users/{userId}/changePassword/:
    patch:
      parameters:
        - $ref: '#/components/parameters/userId'
      description: Update user password by id. Available only for users with admin permissions.
      tags:
        - usersService
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              $ref: '#/components/schemas/ChangePasswordDto'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    $ref: '#/components/schemas/User'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
      security:
        - bearerAuth: []
  /company/v1/users/me/:
    get:
      tags:
        - usersService
      description: Get self profile. Available only for authorized users
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    $ref: '#/components/schemas/User'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
      security:
        - bearerAuth: []
  /company/v1/users/me/changePassword/:
    patch:
      description: Update self password. Available only for authorized users.
      tags:
        - usersService
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              $ref: '#/components/schemas/ChangeSelfPasswordDto'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    $ref: '#/components/schemas/User'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
      security:
        - bearerAuth: []

  /company/v1/users/search/:
    get:
      description: Search. Available only for authorized users.
      tags:
        - usersService
      parameters:
        - $ref: '#/components/parameters/searchEmail'
        - $ref: '#/components/parameters/searchFirstName'
        - $ref: '#/components/parameters/searchLastName'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    $ref: '#/components/schemas/User'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
      security:
        - bearerAuth: []
  # users end

  # auth begin
  /company/v1/auth/signIn/:
    description: Sign in user by email, password. Returns token, refreshToken
    post:
      tags:
        - authService
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              $ref: '#/components/schemas/SignInDto'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    $ref: '#/components/schemas/Token'
  /company/v1/auth/confirmEmail/:
    description: Confirm email user. Returns token, refreshToken
    post:
      tags:
        - authService
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              $ref: '#/components/schemas/ConfirmEmailDto'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    $ref: '#/components/schemas/Token'
  /company/v1/auth/refreshToken/:
    description: refreshToken exprired token. Returns new token
    post:
      tags:
        - authService
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    $ref: '#/components/schemas/Token'
  # auth end

  # departments begin
  /company/v1/departments/:
    get:
      description: Get departments list. Available only for authorized users.
      tags:
        - departmentsService
      parameters:
        - $ref: '#/components/parameters/page'
        - $ref: '#/components/parameters/list'
        # - $ref: '#/components/parameters/queryDepartments'
        - $ref: '#/components/parameters/filterDepartments'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  meta:
                    type: object
                    $ref: '#/components/schemas/Meta'
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Department'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
      security:
        - bearerAuth: []
    post:
      description: Create department. Available only for users with admin permissions
      tags:
        - departmentsService
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    $ref: '#/components/schemas/Department'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/Forbidden'
      security:
        - bearerAuth: []
  /company/v1/departments/{departmentId}/:
    parameters:
      - $ref: '#/components/parameters/departmentId'
    get:
      description: Get department by id. Available only for authorized users.
      tags:
        - departmentsService
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    $ref: '#/components/schemas/Department'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
      security:
        - bearerAuth: []
    patch:
      description:
        Update department data (set head department, move users, set parent department)
        Available only for head parent department or users with admin permissions. Returns updated department data
      tags:
        - departmentsService
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              $ref: '#/components/schemas/DepartmentPatch'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    $ref: '#/components/schemas/Department'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
      security:
        - bearerAuth: []
    delete:
      description:
        Delete department. Available only for users with admin permissions.
      tags:
        - departmentsService
      responses:
        '204':
          description: No content
        '401':
          $ref: '#/components/responses/UnauthorizedError'
      security:
        - bearerAuth: []
  # departments end

  # newsfeed begin
  /newsfeed/v1/posts/:
    get:
      description: Get posts list. Available only for authorized users.
      tags:
        - newsFeedService
      parameters:
        - $ref: '#/components/parameters/page'
        - $ref: '#/components/parameters/list'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  meta:
                    type: object
                    $ref: '#/components/schemas/Meta'
                  data:
                    type: array
                    items:
                      oneOf:
                        - $ref: '#/components/schemas/Post'
                        - allOf:
                            - $ref: '#/components/schemas/Post'
                            - type: object
                              properties:
                                comments:
                                  example: "[]"
        '401':
          $ref: '#/components/responses/UnauthorizedError'
      security:
        - bearerAuth: []
    post:
      description: Create post. Available only for authorized users.
      tags:
        - newsFeedService
      requestBody:
        content:
          multipart/form-data:
            schema:
              $ref: '#/components/schemas/CreateUpdatePostDto'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    allOf:
                      - $ref: '#/components/schemas/Post'
                      - type: object
                        properties:
                          comments:
                            example: "[]"
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/Forbidden'
      security:
        - bearerAuth: []
  /newsfeed/v1/posts/{postId}/:
    parameters:
      - $ref: '#/components/parameters/postId'
    patch:
      description: Update post. Available only for author.
      tags:
        - newsFeedService
      requestBody:
        content:
          multipart/form-data:
            schema:
              $ref: '#/components/schemas/CreateUpdatePostDto'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/Post'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/Forbidden'
      security:
        - bearerAuth: []
    delete:
      description: Delete post. Available only for author or users with admin permissions.
      tags:
        - newsFeedService
      responses:
        '204':
          description: No content
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/Forbidden'
      security:
        - bearerAuth: []
  /newsfeed/v1/posts/{postId}/comments/:
    parameters:
      - $ref: '#/components/parameters/postId'
    get:
      parameters:
        - $ref: '#/components/parameters/page'
        - $ref: '#/components/parameters/list'
      description: Get comments for post. Available only for authorized users and users who have access to the post
      tags:
        - newsFeedService
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  meta:
                    type: object
                    $ref: '#/components/schemas/Meta'
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Comment'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/Forbidden'
      security:
        - bearerAuth: []
    post:
      description: Create comment for the post. Available only for authorized users and users who have access to the post
      tags:
        - newsFeedService
      requestBody:
        content:
          multipart/form-data:
            schema:
              $ref: '#/components/schemas/CreateUpdateCommentDto'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/Comment'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/Forbidden'
      security:
        - bearerAuth: []
  /newsfeed/v1/posts/{postId}/comments/{commentId}/:
    parameters:
      - $ref: '#/components/parameters/postId'
      - $ref: '#/components/parameters/commentId'
    patch:
      description: Update comment for the post. Available only for author.
      tags:
        - newsFeedService
      requestBody:
        content:
          multipart/form-data:
            schema:
              $ref: '#/components/schemas/CreateUpdateCommentDto'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/Comment'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/Forbidden'
      security:
        - bearerAuth: []
    delete:
      description: Delete comment for the post. Available only for author or users with admin permissions.
      tags:
        - newsFeedService
      responses:
        '204':
          description: No content
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/Forbidden'
      security:
        - bearerAuth: []
  # newsfeed end

  # tasks begin
  /tasks/v1/tasks/:
    get:
      description: Get available tasks list. Available only for authorized users.
      tags:
        - tasksService
      parameters:
        - $ref: '#/components/parameters/page'
        - $ref: '#/components/parameters/list'
        - $ref: '#/components/parameters/field_name'
        - $ref: '#/components/parameters/sort_by'
        - $ref: '#/components/parameters/order_by'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  meta:
                    type: object
                    $ref: '#/components/schemas/Meta'
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Task'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
      security:
        - bearerAuth: []
    post:
      description: Create task. Available only for authorized users.
      tags:
        - tasksService
      requestBody:
        content:
          multipart/form-data:
            schema:
              allOf:
                - $ref: '#/components/schemas/CreateEditTaskDto'
                - type: object
                  properties:
                    fixed:
                      type: boolean
                      default: false
                      example: true
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Task'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
      security:
        - bearerAuth: []
  # /tasks/v1/tasks/statuses/:
  #   get:
  #     description: Delegate task by id. Available only for authorized users and user task maker or users with admin permissions.
  #     tags:
  #       - tasksService
  #     responses:
  #       '200':
  #         description: OK
  #         content:
  #           application/json:
  #             schema:
  #               $ref: '#/components/schemas/TaskStatuses'

  #       '401':
  #         $ref: '#/components/responses/UnauthorizedError'
  #     security:
  #       - bearerAuth: []
  /tasks/v1/tasks/{taskId}/:
    parameters:
      - $ref: '#/components/parameters/taskId'
    get:
      description: Get task by id. Available only for authorized users and users who have access to task.
      tags:
        - tasksService
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Task'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
      security:
        - bearerAuth: []
    patch:
      description: Edit task by id. Available only for authorized users and task maker.
      tags:
        - tasksService
      requestBody:
        content:
          multipart/form-data:
            schema:
              allOf:
                - $ref: '#/components/schemas/CreateEditTaskDto'
                - type: object
                  properties:
                    archive:
                      type: boolean
                      default: false
                      example: true
                    fixed:
                      type: boolean
                      default: false
                      example: true
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Task'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
      security:
        - bearerAuth: []
    delete:
      description: Delete task by id. Available only for authorized users and task maker.
      tags:
        - tasksService
      responses:
        '204':
          description: No content
        '401':
          $ref: '#/components/responses/UnauthorizedError'
      security:
        - bearerAuth: []
  /tasks/v1/tasks/{taskId}/denial/:
    post:
      description: Abandoning a task. Available only for authorized users.
      tags:
        - tasksService
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateDenial'
      responses:
        '200':
          description: OK
        '401':
          $ref: '#/components/responses/UnauthorizedError'
      security:
        - bearerAuth: [ ]
  # TODO temporary commented
  # /tasks/v1/tasks/{taskId}/delegate/:
  #   parameters:
  #     - $ref: '#/components/parameters/taskId'
  #   post:
  #     description: Delegate task by id. Available only for authorized users and user task maker or users with admin permissions.
  #     tags:
  #       - tasksService
  #     requestBody:
  #       content:
  #         application/json:
  #           schema:
  #             type: object
  #             properties:
  #               responsibleId:
  #                 type: string
  #                 description: ID of new responsible person
  #                 example: 2
  #     responses:
  #       '200':
  #         description: OK
  #         content:
  #           application/json:
  #             schema:
  #               allOf:
  #                 - $ref: '#/components/schemas/Task'
  #                 - type: object
  #                   properties:
  #                     responsibleId:
  #                       type: string
  #                       example: 2

  #       '401':
  #         $ref: '#/components/responses/UnauthorizedError'
  #     security:
  #       - bearerAuth: []
  /tasks/v1/tasks/{taskId}/comments/:
    parameters:
      - $ref: '#/components/parameters/taskId'
    get:
      parameters:
        - $ref: '#/components/parameters/page'
        - $ref: '#/components/parameters/list'
      description: Get comments task by id. Available only for authorized users and users who have access to task.
      tags:
        - tasksService
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  meta:
                    type: object
                    $ref: '#/components/schemas/Meta'
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Comment'

        '401':
          $ref: '#/components/responses/UnauthorizedError'
      security:
        - bearerAuth: []
    post:
      description: Create comment for task. Available only for authorized users and users who have access to task.
      tags:
        - tasksService
      requestBody:
        content:
          multipart/form-data:
            schema:
              allOf:
                - $ref: '#/components/schemas/CreateUpdateCommentDto'
                - type: object
                  properties:
                    denial:
                      type: boolean
                      default: false
                      example: true
                      description: When the comment is a rejection and the task is not accepted.
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/Comment'
                  - type: object
                    properties:
                      responsibleId:
                        type: string
                        example: 2
                      denial:
                        type: boolean
                        example: true

        '401':
          $ref: '#/components/responses/UnauthorizedError'
      security:
        - bearerAuth: []
  /tasks/v1/tasks/{taskId}/comments/{commentId}/:
    parameters:
      - $ref: '#/components/parameters/taskId'
      - $ref: '#/components/parameters/commentId'
    delete:
      description: Delete comment to task by id. Available only for authorized users and author comment.
      tags:
        - tasksService
      responses:
        '204':
          description: No content

        '401':
          $ref: '#/components/responses/UnauthorizedError'
      security:
        - bearerAuth: []
    patch:
      description: Update comment for task. Available only for authorized users and author comment.
      tags:
        - tasksService
      requestBody:
        content:
          multipart/form-data:
            schema:
              allOf:
                - $ref: '#/components/schemas/CreateUpdateCommentDto'
                - type: object
                  properties:
                    denial:
                      type: boolean
                      default: false
                      example: true
                      description: When the comment is a rejection and the task is not accepted.
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/Comment'
                  - type: object
                    properties:
                      responsibleId:
                        type: string
                        example: 2
                      denial:
                        type: boolean
                        example: true

        '401':
          $ref: '#/components/responses/UnauthorizedError'
      security:
        - bearerAuth: []

  /tasks/v1/stages/:
    get:
      description: Get canban stages. Available only for authorized users.
      tags:
        - tasksService
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/CanbanStage'

        '401':
          $ref: '#/components/responses/UnauthorizedError'
      security:
        - bearerAuth: []
    post:
      description: Create canban stage. Available only for authorized users.
      tags:
        - tasksService
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateEditCanbanStageDto'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/CanbanStage'
                  - type: object
                    properties:
                      id:
                        type: string
                        example: 2
                      afterId:
                        type: string
                        example: 1

        '401':
          $ref: '#/components/responses/UnauthorizedError'
      security:
        - bearerAuth: []
  /tasks/v1/stages/{stageId}/:
    get:
      description: Get canban stage by id. Available only for authorized users.
      tags:
        - tasksService
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/CanbanStage'

        '401':
          $ref: '#/components/responses/UnauthorizedError'
      security:
        - bearerAuth: []
    patch:
      description: Update canban stage by id. Available only for authorized users.
      tags:
        - tasksService
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateEditCanbanStageDto'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/CanbanStage'
                  - type: object
                    properties:
                      id:
                        type: string
                        example: 2
                      afterId:
                        type: string
                        example: 1

        '401':
          $ref: '#/components/responses/UnauthorizedError'
      security:
        - bearerAuth: []
    delete:
      description: Create comment for task. Available only for authorized users.
      tags:
        - tasksService
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateEditCanbanStageDto'
      responses:
        '204':
          description: No content

        '401':
          $ref: '#/components/responses/UnauthorizedError'
      security:
        - bearerAuth: []
  /tasks/v1/stages/{stageId}/moveTask/:
    post:
      description: Moving a task to stage
      tags:
        - tasksService
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MoveTaskCanbanStageDto'
      responses:
        '200':
          description: OK
        '401':
          $ref: '#/components/responses/UnauthorizedError'
      security:
        - bearerAuth: []

  /tasks/v1/tasks/{taskId}/checkList/:
    parameters:
      - $ref: '#/components/parameters/taskId'
    get:
      description: Get comments task by id. Available only for authorized users and users who have access to task.
      tags:
        - tasksService
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  allOf:
                    - $ref: '#/components/schemas/CheckList'
                    - type: object
                      properties:
                        checkListItemIds:
                          type: array
                          items:
                            type: string
                          example: ["2", "3"]

        '401':
          $ref: '#/components/responses/UnauthorizedError'
      security:
        - bearerAuth: []
    post:
      description: Create check list for task. Available only for authorized users and users who have access to task.
      tags:
        - tasksService
      requestBody:
        content:
          application/json:
            schema:
              allOf:
                - $ref: '#/components/schemas/CreateUpdateCheckList'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/CheckList'

        '401':
          $ref: '#/components/responses/UnauthorizedError'
      security:
        - bearerAuth: []

  /tasks/v1/tasks/{taskId}/checkList/{checkListId}/:
    parameters:
      - $ref: '#/components/parameters/taskId'
      - $ref: '#/components/parameters/checkListId'
    patch:
      description: Update check list for task. Available only for authorized users.
      tags:
        - tasksService
      requestBody:
        content:
          application/json:
            schema:
              allOf:
                - $ref: '#/components/schemas/CreateUpdateCheckList'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/CreateUpdateCheckList'

        '401':
          $ref: '#/components/responses/UnauthorizedError'
      security:
        - bearerAuth: []
    delete:
      description: Delete check list to task by id. Available only for authorized users.
      tags:
        - tasksService
      responses:
        '204':
          description: No content

        '401':
          $ref: '#/components/responses/UnauthorizedError'
      security:
        - bearerAuth: []

  /tasks/v1/checkList/{checkListId}/:
    parameters:
      - $ref: '#/components/parameters/checkListId'
    get:
      description: Get items check list by id. Available only for authorized users.
      tags:
        - tasksService
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  allOf:
                    - type: object
                      properties:
                        id:
                          type: string
                          description: Check list item id
                          example: 1
                    - $ref: '#/components/schemas/CheckListItem'

        '401':
          $ref: '#/components/responses/UnauthorizedError'
      security:
        - bearerAuth: []
    post:
      description: Create item check list for task. Available only for authorized users.
      tags:
        - tasksService
      requestBody:
        content:
          application/json:
            schema:
              allOf:
                - $ref: '#/components/schemas/CheckListItem'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                allOf:
                  - type: object
                    properties:
                      id:
                        type: string
                        description: Check list item id
                        example: 1
                  - $ref: '#/components/schemas/CheckListItem'

        '401':
          $ref: '#/components/responses/UnauthorizedError'
      security:
        - bearerAuth: []

  /tasks/v1/checkList/{checkListId}/{checkListItemId}:
    parameters:
      - $ref: '#/components/parameters/checkListId'
      - $ref: '#/components/parameters/checkListItemId'
    delete:
      description: Delete item to check list by id. Available only for authorized users.
      tags:
        - tasksService
      responses:
        '204':
          description: No content

        '401':
          $ref: '#/components/responses/UnauthorizedError'
      security:
        - bearerAuth: []
    patch:
      description: Update check list for task. Available only for authorized users.
      tags:
        - tasksService
      requestBody:
        content:
          application/json:
            schema:
              allOf:
                - $ref: '#/components/schemas/CheckListItem'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                allOf:
                  - type: object
                    properties:
                      id:
                        type: string
                        description: Check list item id
                        example: 1
                  - $ref: '#/components/schemas/CheckListItem'

        '401':
          $ref: '#/components/responses/UnauthorizedError'
      security:
        - bearerAuth: []


  /tasks/v1/tasks/massEdit/complete/:
    post:
      description: Bulk editing tasks
      tags:
        - tasksService
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MassEditIds'
      responses:
        '200':
          description: OK
        '401':
          $ref: '#/components/responses/UnauthorizedError'
      security:
        - bearerAuth: []

  /tasks/v1/tasks/massEdit/archive/:
    post:
      description: Bulk editing tasks
      tags:
        - tasksService
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MassEditIds'
      responses:
        '200':
          description: OK
        '401':
          $ref: '#/components/responses/UnauthorizedError'
      security:
        - bearerAuth: []

  /tasks/v1/tasks/massEdit/delete/:
    post:
      description: Bulk editing tasks
      tags:
        - tasksService
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MassEditIds'
      responses:
        '200':
          description: OK
        '401':
          $ref: '#/components/responses/UnauthorizedError'
      security:
        - bearerAuth: []

  # tasks end

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  responses:
    UnauthorizedError:
      description: Access token is missing or invalid
    Forbidden:
      description: Forbidden

  parameters:
    userId:
      name: userId
      in: path
      description: User id
      required: true
      schema:
        type: string
    departmentId:
      name: departmentId
      in: path
      description: Department id
      required: true
      schema:
        type: string
    page:
      name: page
      in: query
      description: current page
      required: false
      schema:
        type: integer
      default: 1
      example: 1
    searchEmail:
      name: email
      in: query
      required: false
      schema:
        type: string
      example: rar.stas@gmail.com
    searchFirstName:
      name: firstName
      in: query
      required: false
      schema:
        type: string
      example: Stas
    searchLastName:
      name: LastName
      in: query
      required: false
      schema:
        type: string
      example: Raranetskyi
    list:
      name: list
      in: query
      description: how many items should be per page
      required: false
      schema:
        type: number
      example: 10
      default: 20
    query:
      name: query
      in: query
      description: search query
      required: false
      schema:
        type: string
      example: "some query string"
      default: ""
    filter:
      name: filter
      in: query
      description: Fields, corresponding to the available list of entity.
      required: false
      style: deepObject
      schema:
        type: object
    filterUsers:
      allOf:
        - $ref: '#/components/parameters/filter'
        - type: object
          description: Fields, corresponding to the available list of fields user.
          example:
            email: rar.stas@gmail.com
            firstName: Stas
            lastName: Raranetskyi
            phone: "+3801234567"
            position: CTO
            active: true
            departmentsIds: ["1111", "2222"]
            roles:
              - OWNER
              - ADMIN
    queryUsers:
      allOf:
        - $ref: '#/components/parameters/query'
        - type: string
          description: Search by email, firstName, lastName
          example: rar.stas@gmail.com
    filterDepartments:
      allOf:
        - $ref: '#/components/parameters/filter'
        - type: object
          description: Fields, corresponding to the available list of fields department.
          example:
            name: "Frontend department"
            headId: "1111"
            parentDepartmentId: "1111"
            usersIds: ["1111", "2222", "3333"]
    queryDepartments:
      allOf:
        - $ref: '#/components/parameters/query'
        - type: string
          description: Search by name department
          example: Frontend department
    postId:
      name: postId
      in: path
      description: Post id
      required: true
      schema:
        type: string
    commentId:
      name: commentId
      in: path
      description: Comment id
      required: true
      schema:
        type: string
    taskId:
      name: taskId
      in: path
      description: Task id
      required: true
      schema:
        type: string
    stageId:
      name: stageId
      in: path
      description: Stage id
      required: true
      schema:
        type: string
    order_by:
      name: order_by
      in: query
      description: sorting direction
      required: false
      schema:
        type: string
      default: desc
      example: order_by=asc
    field_name:
      name: field_name
      in: query
      description: the field we are looking for
      required: false
      schema:
        type: string
      example: priority=Low
    sort_by:
      name: sort_by
      in: query
      description: the field by which to sort
      required: false
      schema:
        type: string
      example: sort_by=deadline
    checkListId:
      name: checkListId
      in: path
      description: Check List id
      required: true
      schema:
        type: string
    checkListItemId:
      name: checkListItemId
      in: path
      description: Check List item id
      required: true
      schema:
        type: string
  schemas:
    # common begin
    Meta:
      type: object
      properties:
        total:
          type: number
          example: 100
        page:
          type: number
          example: 1
        list:
          type: number
          example: 10

    Roles:
      type: array
      items:
        type: string
      example:
        - OWNER
        - USER
    Email:
      type: string
      example: 'rar.stas@gmail.com'
    Phone:
      type: array
      items:
        object:
        properties:
          type:
            type: string
            enum: [WORK, MOBILE, HOME]
            example: WORK
          value:
            type: string
            example: '+380123456789'

    Date:
      type: number
      description: timestamp in seconds
      default: 0
      example: 1654180120
    Files:
      type: array
      items:
        type: string
      example:
        - path/to/image.jpg
        - path/to/image.png
    # common end

    # users begin
    User:
      type: object
      properties:
        id:
          type: string
          example: 1
        email:
          $ref: '#/components/schemas/Email'
        firstName:
          type: string
          example: Stas
        lastName:
          type: string
          example: Raranetskyi
        position:
          type: string
          example: CTO
        specialization:
          type: string
          example: Specialist
        country:
          type: string
          example: Ukraine
        city:
          type: string
          example: Kiyv
        avatar:
          type: string
          example: /storage/avatars/c4ca423/avatar.jpeg
        aboutMyself:
          type: string
          example: about me
        phone:
          $ref: '#/components/schemas/Phone'
        active:
          type: boolean
        birthday:
          $ref: '#/components/schemas/Date'
        showBirthYear:
          type: boolean
          default: false
          example: true
        roles:
          $ref: '#/components/schemas/Roles'
        departmentsIds:
          type: array
          items:
            type: string
          example:
            - '1'
            - '2'
        socialMedia:
          $ref: '#/components/schemas/SocialMedia'

    UpdateUserDto:
      type: object
      properties:
        email:
          $ref: '#/components/schemas/Email'
        firstName:
          type: string
          example: Stas
        lastName:
          type: string
          example: Raranetskyi
        specialization:
          type: string
          example: Specialist
        country:
          type: string
          example: Ukraine
        city:
          type: string
          example: Kiyv
        avatar:
          type: string
          example: /storage/avatars/c4ca423/avatar.jpeg
        aboutMyself:
          type: string
          example: about me
        phone:
          $ref: '#/components/schemas/Phone'
        birthday:
          $ref: '#/components/schemas/Date'
        showBirthYear:
          type: boolean
          default: false
          example: true
        departmentsIds:
          type: array
          items:
            type: string
          example:
            - '1'
            - '2'
        socialMedia:
          $ref: '#/components/schemas/SocialMedia'
    UpdateRolesDto:
      allOf:
        - $ref: '#/components/schemas/Roles'
        - type: string
          example:
            - ADMIN
    UpdateUserPosition:
      type: object
      properties:
        position:
          type: string
      example:
        position: new position
    # users begin

    # auth
    SocialMedia:

      type: array
      items:
        object:
        properties:
          name:
            type: string
            example: facebook
          link:
            type: string
            example: https://www.facebook.com
    Token:
      type: object
      properties:
        expireInSeconds:
          type: number
          example: 720
        jwt:
          type: string
          example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjEyMzEyMzEyMyIsImZpcnN0TmFtZSI6IlN0YXMiLCJsYXN0TmFtZSI6IlJhcmFuZXRza3lpIiwiZW1haWwiOiJyYXIuc3Rhc0BnbWFpbC5jb20iLCJyb2xlcyI6WyJVU0VSIiwiQURNSU4iLCJPV05FUiJdfQ.au16u5LHJqdvhiPrpXDhN4NZn8Cae09I6BEmed7mt8w
        refreshToken:
          type: string
          example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjEyMzEyMzEyMyIsImZpcnN0TmFtZSI6IlN0YXMiLCJsYXN0TmFtZSI6IlJhcmFuZXRza3lpIiwiZW1haWwiOiJyYXIuc3Rhc0BnbWFpbC5jb20iLCJyb2xlcyI6WyJVU0VSIiwiQURNSU4iLCJPV05FUiJdfQ.au16u5LHJqdvhiPrpXDhN4NZn8Cae09I6BEmed7mt8w
    SignUpDto:
      type: object
      properties:
        email:
          $ref: '#/components/schemas/Email'
        firstName:
          type: string
        lastName:
          type: string
        password:
          type: string
      example:
        email:
        password: "12345678"
        firstName: Stas
        lastName: Raranetskyi
    JWT:
      type: object
      properties:
        id:
          type: string
          example: 1
        email:
          $ref: '#/components/schemas/Email'
        firstName:
          type: string
          example: Stas
        lastName:
          type: string
          example: Raranetskyi
        workspaceId:
          type: string
          example: 123123
        roles:
          $ref: '#/components/schemas/Roles'
        departmentsIds:
          type: array
          items:
            type: string
          example:
            - 1
            - 2
          description: All departments from the parent
    SignInDto:
      type: object
      properties:
        email:
          $ref: '#/components/schemas/Email'
        password:
          type: string
          example: 12345678
    ConfirmEmailDto:
      type: object
      properties:
        email:
          $ref: '#/components/schemas/Email'
        token:
          type: string
          example: r6pvb5pllte
    ChangePasswordDto:
      type: object
      properties:
        password:
          type: string
          password: 12345678
    ChangeSelfPasswordDto:
      type: object
      properties:
        oldPassword:
          type: string
          password: 12345678
        newPassword:
          type: string
          password: 12345678
    # auth end

    # Departments begin
    Department:
      type: object
      properties:
        id:
          type: string
          example: 1
        name:
          type: string
          example: Frontend department
        headId:
          type: string
          example: 1
        parentDepartmentId:
          type: string
          nulable: true
          default: null
          example: 1
        usersIds:
          type: string
          example:
            - '1'
            - '2'
    DepartmentPatch:
      type: object
      properties:
        name:
          type: string
          example: Frontend department
        headId:
          type: string
          example: 1
        parentDepartmentId:
          type: string
          nulable: true
          default: null
          example: 1
        usersIds:
          type: string
          example:
            - '1'
            - '2'
    # Departments end

    # news feed begin
    Post:
      type: object
      properties:
        id:
          type: string
          example: 1
        title:
          type: string
          example: Title post
        # subject:
        #   type: string
        #   example: Subject post
        message:
          type: string
          example: Message post
        authorId:
          type: string
          example: 1
        files:
          $ref: '#/components/schemas/Files'
        date:
          $ref: '#/components/schemas/Date'
        comments:
          type: array
          items:
            $ref: '#/components/schemas/Comment'
    RecipientsPost:
      type: object
      properties:
        exclude:
          type: object
          description: A field by which you can exclude the viewing of a post for users and / or departments
          properties:
            departmentsIds:
              type: array
              items:
                type: string
              example:
                - "1"
                - "2"
              examples:
                arrayDepartmentsIds:
                  - "1"
                  - "2"
                empty: []
            usersIds:
              type: array
              items:
                type: string
              example:
                - "1"
                - "2"
              examples:
                arrayUsersIds:
                  - "1"
                  - "2"
                empty: []
        include:
          type: object
          description: A field by which you can include the viewing of a post for users and / or departments
          properties:
            departmentsIds:
              type: array
              items:
                type: string
              example:
                - "3"
                - "4"
              examples:
                arrayDepartmentsIds:
                  - "1"
                  - "2"
                empty: []
            usersIds:
              type: array
              items:
                type: string
              example:
                - "3"
                - "4"
              examples:
                arrayUsersIds:
                  - "1"
                  - "2"
                empty: []
    CreateUpdatePostDto:
      type: object
      properties:
        title:
          type: string
          example: Title post
        message:
          type: string
          example: Message post
        files:
          type: array
          items:
            type: string
            format: binary
        recipients:
          $ref: '#/components/schemas/RecipientsPost'
          # example:
          #   exclude:
          #     departmentsIds:
          #       - "1"
          #       - "2"
          #     usersIds:
          #       - "1"
          #       - "2"
    Comment:
      type: object
      properties:
        id:
          type: string
          example: 1
        files:
          $ref: '#/components/schemas/Files'
        message:
          type: string
          example: Message comment
        authorId:
          type: string
          example: 1
        date:
          $ref: '#/components/schemas/Date'
    CreateUpdateCommentDto:
      type: object
      properties:
        message:
          type: string
          example: Message post
        files:
          type: array
          items:
            type: string
            format: binary
    # news feed end

    # tasks begin
    Task:
      type: object
      properties:
        title:
          type: string
          example: Describe swagger api for tasksService
        deadline:
          $ref: '#/components/schemas/Date'
        closedDate:
          $ref: '#/components/schemas/Date'
        createdBy:
          type: string
          example: 1
        closedBy:
          type: string
          example: 1
        createdDate:
          $ref: '#/components/schemas/Date'
        responsibleId:
          description: ID of responsible person
          type: string
          example: 1
        accomplicesIds:
          type: array
          items:
            type: string
          example: ["2", "3"]
        auditorsIds:
          type: array
          items:
            type: string
          example: ["4", "5"]
        body:
          type: string
          example: <b>need use swagger-ui@4.x</b>
        status:
          $ref: '#/components/schemas/TaskStatus'
        kanbanStageId:
          type: string
          example: 2
        priority:
          type: string
          enum:
            - Low
            - Average
            - High
        acceptResult:
          type: boolean
          default: false
          example: true
        requiredResult:
          type: boolean
          default: false
          example: true
        resultCommentId:
          type: string
          example: 1
        fixed:
          type: boolean
          default: false
          example: true
        archive:
          type: boolean
          default: false
          example: false
        files:
          $ref: '#/components/schemas/Files'

    CreateEditTaskDto:
      type: object
      properties:
        title:
          type: string
          example: Describe swagger api for tasksService
        deadline:
          $ref: '#/components/schemas/Date'
        responsibleId:
          description: ID of responsible person
          type: string
          example: 1
        accomplicesIds:
          type: array
          items:
            type: string
          example: ["2", "3"]
        auditorsIds:
          type: array
          items:
            type: string
          example: ["4", "5"]
        body:
          type: string
          example: <b>need use swagger-ui@4.x</b>
        priority:
          type: string
          enum:
            - LOW
            - AVERAGE
            - HIGH
        files:
          type: array
          items:
            type: string
            format: binary

    TaskStatus:
      type: string
      enum:
        - TO_DO
        - IN_PROGRESS
        - READY_FOR_REVIEW
        - DONE
        - BLOCKED

    TaskStatuses:
      type: array
      items:
        type: string
      example:
        - TO_DO
        - IN_PROGRESS
        - READY_FOR_REVIEW
        - DONE
        - BLOCKED

    CanbanStage:
      type: object
      properties:
        id:
          type: string
          example: 1
        title:
          type: string
          example: To do
        color:
          type: string
          example: "#ff0000"
        afterId:
          type: string
          description: The ID of the stage to add after.
          example: 0

    CreateEditCanbanStageDto:
      type: object
      properties:
        title:
          type: string
          example: In progress
        color:
          type: string
          example: "#ff0000"
        afterId:
          type: string
          description: The ID of the stage to add after.
          example: 1
    MoveTaskCanbanStageDto:
      type: object
      properties:
        id:
          type: string
          description: Task id
          example: 1

    CreateDenial:
      type: object
      properties:
        reason:
          type: string
          example: No time

    CreateUpdateCheckList:
      type: object
      properties:
        title:
          type: string
          example: New check list

    CheckList:
      type: object
      properties:
        id:
          type: string
          description: Check list id
          example: 1
        title:
          type: string
          example: New check list

    CheckListItem:
      type: object
      properties:
        title:
          type: string
          example: First item
        responsibleId:
          description: ID of responsible person
          type: string
          example: 1
        deadline:
          $ref: '#/components/schemas/Date'

    MassEditIds:
      type: object
      properties:
        ids:
          type: array
          items:
            type: string
          example: ["1", "2"]

    # tasks end

